pipeline:
  publish-docker-image:
    image: 258875347723.dkr.ecr.us-east-1.amazonaws.com/drone-plugin-docker-ecr
    repo: 258875347723.dkr.ecr.us-east-1.amazonaws.com/reddit-nodejs
    registry: 258875347723.dkr.ecr.us-east-1.amazonaws.com
    region: us-east-1
    tag: ${DRONE_TAG}
    when:
     event: [ tag ]

  notify:
    image: plugins/slack
    channel: desktop-salon
    secrets: [ SLACK_WEBHOOK ]
    template: >
      {{#success build.status}}
        ğŸ“¦ Packaged <{{build.link}}|{{repo.name}}@{{build.tag}}>
      {{else}}
        ğŸš¨ *Failed* to package ğŸ“¦ <{{build.link}}|{{repo.name}}@{{build.tag}}>
      {{/success}}
    when:
      status: [ success, failure ]
      event: [ tag ]
